<!--pages/schedule/schedule.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨èƒŒæ™¯ -->
  <view class="header-bg">
    <view class="header-content">
      <text class="header-title">è·¯çº¿é¢„çº¦</text>
      <text class="header-subtitle">æå‰é¢„çº¦ï¼Œå®‰å…¨å‡ºè¡Œ</text>
    </view>
  </view>

  <view class="content-area">
    <form bindsubmit="submitForm">
      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="form-section">
        <view class="section-header">
          <view class="section-icon">ğŸ‘¤</view>
          <text class="section-title">åŸºæœ¬ä¿¡æ¯</text>
        </view>
        <view class="form-item">
          <text class="label">å§“å</text>
          <input class="input" name="name" placeholder="è¯·è¾“å…¥å§“å" value="{{formData.name}}"/>
        </view>
        <view class="form-item">
          <text class="label">è½¦ç‰Œå·</text>
          <input class="input" name="plateNumber" placeholder="è¯·è¾“å…¥è½¦ç‰Œå·" value="{{formData.plateNumber}}"/>
        </view>
        <view class="form-item">
          <text class="label">è½¦è¾†ç±»å‹</text>
          <picker class="picker" bindchange="bindCarTypeChange" value="{{carTypeIndex}}" range="{{carTypes}}" range-key="name">
            <view class="picker-value">
              <text class="picker-text">{{carTypes[carTypeIndex].name}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>
      
      <!-- é¢„çº¦æ—¶é—´ -->
      <view class="form-section">
        <view class="section-header">
          <view class="section-icon">ğŸ•</view>
          <text class="section-title">é¢„çº¦æ—¶é—´</text>
        </view>
        <view class="form-row">
          <view class="form-item half">
            <text class="label">é¢„çº¦æ—¥æœŸ</text>
            <picker class="picker" mode="date" bindchange="bindDateChange" value="{{formData.reservationDate}}" start="{{today}}" end="{{maxDate}}">
              <view class="picker-value">
                <text class="picker-text {{formData.reservationDate ? '' : 'placeholder'}}">{{formData.reservationDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
          <view class="form-item half">
            <text class="label">é¢„çº¦æ—¶é—´</text>
            <picker class="picker" mode="time" bindchange="bindTimeChange" value="{{formData.reservationTime}}">
              <view class="picker-value">
                <text class="picker-text {{formData.reservationTime ? '' : 'placeholder'}}">{{formData.reservationTime || 'é€‰æ‹©æ—¶é—´'}}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </view>
      </view>
      
      <!-- è·¯çº¿ä¿¡æ¯ -->
      <view class="form-section">
        <view class="section-header">
          <view class="section-icon">ğŸ“</view>
          <text class="section-title">è·¯çº¿ä¿¡æ¯</text>
        </view>
        <view class="route-input-group">
          <view class="route-markers">
            <view class="marker start">èµ·</view>
            <view class="marker-line"></view>
            <view class="marker end">ç»ˆ</view>
          </view>
          <view class="route-inputs">
            <view class="form-item route-item">
              <input class="input" name="startPoint" placeholder="è¯·è¾“å…¥èµ·ç‚¹" value="{{formData.startPoint}}" bindinput="searchStartPoint"/>
              <view class="search-results" wx:if="{{startResults.length > 0}}">
                <view class="result-item" wx:for="{{startResults}}" wx:key="id" bindtap="selectStartPoint" data-item="{{item}}">
                  <image class="result-icon" src="/images/hu/location.png"/>
                  <view class="result-text">
                    <text class="result-title">{{item.title}}</text>
                    <text class="result-address">{{item.address}}</text>
                  </view>
                </view>
              </view>
            </view>
            <view class="form-item route-item">
              <input class="input" name="endPoint" placeholder="è¯·è¾“å…¥ç»ˆç‚¹" value="{{formData.endPoint}}" bindinput="searchEndPoint"/>
              <view class="search-results" wx:if="{{endResults.length > 0}}">
                <view class="result-item" wx:for="{{endResults}}" wx:key="id" bindtap="selectEndPoint" data-item="{{item}}">
                  <image class="result-icon" src="/images/hu/location.png"/>
                  <view class="result-text">
                    <text class="result-title">{{item.title}}</text>
                    <text class="result-address">{{item.address}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- åœ°å›¾ -->
        <view class="map-container">
          <map wx:if="{{mapReady && !locationError}}" class="map" longitude="{{longitude}}" latitude="{{latitude}}" scale="{{mapScale}}" markers="{{markers}}" polyline="{{polyline}}" include-points="{{includePoints}}" show-location></map>
          <view class="map-overlay" wx:if="{{!mapReady || locationError}}">
            <view class="loading-icon" wx:if="{{!mapReady}}">ğŸ—ºï¸</view>
            <text wx:if="{{!mapReady}}">åœ°å›¾åŠ è½½ä¸­...</text>
            <text wx:if="{{locationError}}">æ— æ³•è·å–ä½ç½®ä¿¡æ¯</text>
          </view>
          <view class="route-info" wx:if="{{routeCalculated}}">
            <view class="route-info-item">
              <text class="route-info-label">è·ç¦»</text>
              <text class="route-info-value">{{routeDistance}}</text>
            </view>
            <view class="route-info-divider"></view>
            <view class="route-info-item">
              <text class="route-info-label">é¢„è®¡</text>
              <text class="route-info-value">{{routeDuration}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å¤‡æ³¨ -->
      <view class="form-section">
        <view class="section-header">
          <view class="section-icon">ğŸ“</view>
          <text class="section-title">å¤‡æ³¨ä¿¡æ¯</text>
        </view>
        <view class="form-item">
          <textarea class="textarea" name="remark" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰" value="{{formData.remark}}"/>
        </view>
      </view>
      
      <!-- æäº¤æŒ‰é’® -->
      <button class="submit-btn {{isCalculating ? 'disabled' : ''}}" form-type="submit" disabled="{{isCalculating}}">
        <text>{{isCalculating ? 'è·¯çº¿è®¡ç®—ä¸­...' : 'æäº¤é¢„çº¦'}}</text>
      </button>
    </form>
  </view>
</view>
