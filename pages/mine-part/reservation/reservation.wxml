<!--pages/mine-part/reservation/reservation.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨èƒŒæ™¯ -->
  <view class="header-bg">
    <view class="header-content">
      <text class="header-title">æˆ‘çš„é¢„çº¦</text>
      <text class="header-subtitle">æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„é¢„çº¦è®°å½•</text>
    </view>
  </view>

  <view class="content-area">
    <!-- ç­›é€‰æ  -->
    <view class="filter-card">
      <picker bindchange="statusFilterChange" value="{{statusIndex}}" range="{{statusOptions}}" range-key="name">
        <view class="filter-item">
          <text>{{statusOptions[statusIndex].name}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
      <picker mode="date" fields="month" bindchange="dateFilterChange" value="{{currentDate}}">
        <view class="filter-item">
          <text>{{dateSelected ? currentDate : 'å…¨éƒ¨æ—¥æœŸ'}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
      <view class="add-btn" bindtap="showAddReservationForm">
        <text>+</text>
      </view>
    </view>

    <!-- é¢„çº¦åˆ—è¡¨ -->
    <scroll-view scroll-y class="reservation-list">
      <view class="reservation-card" wx:for="{{filteredReservations}}" wx:key="id">
        <view class="card-header">
          <text class="reservation-number">{{item.reservationNumber}}</text>
          <view class="status-tag {{item.status === 'å¾…ç¡®è®¤' ? 'pending' : item.status === 'å·²ç¡®è®¤' ? 'confirmed' : item.status === 'å·²å®Œæˆ' ? 'completed' : 'cancelled'}}">
            {{item.status}}
          </view>
        </view>
        
        <view class="route-info">
          <view class="route-point">
            <view class="point-tag start">èµ·</view>
            <text class="point-text">{{item.startPoint}}</text>
          </view>
          <view class="route-line"></view>
          <view class="route-point">
            <view class="point-tag end">ç»ˆ</view>
            <text class="point-text">{{item.endPoint}}</text>
          </view>
        </view>
        
        <view class="info-row">
          <view class="info-item">
            <text class="info-icon">ğŸ“…</text>
            <text class="info-text">{{item.date}} {{item.time}}</text>
          </view>
          <view class="info-item">
            <text class="info-icon">ğŸš›</text>
            <text class="info-text plate">{{item.licensePlate}}</text>
          </view>
        </view>
        
        <view class="card-actions">
          <button class="action-btn view" size="mini" bindtap="viewRoute" data-id="{{item.id}}">æŸ¥çœ‹è·¯çº¿</button>
          <button class="action-btn cancel" size="mini" wx:if="{{item.status === 'å¾…ç¡®è®¤'}}" bindtap="cancelReservation" data-id="{{item.id}}">å–æ¶ˆé¢„çº¦</button>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredReservations.length === 0}}">
        <view class="empty-icon">ğŸ“‹</view>
        <text class="empty-text">æš‚æ— é¢„çº¦è®°å½•</text>
        <text class="empty-hint">ç‚¹å‡»å³ä¸Šè§’+å·åˆ›å»ºæ–°é¢„çº¦</text>
      </view>
    </scroll-view>
  </view>

  <!-- æ·»åŠ é¢„çº¦å¼¹çª— -->
  <view class="modal-mask" wx:if="{{isAddFormVisible}}" bindtap="hideAddReservationForm"></view>
  <view class="modal-container" wx:if="{{isAddFormVisible}}">
    <view class="modal-header">
      <text class="modal-title">æ–°å¢é¢„çº¦</text>
      <view class="modal-close" bindtap="hideAddReservationForm">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">é¢„çº¦ç¼–å·</text>
        <input class="form-input" value="{{newReservation.reservationNumber}}" disabled placeholder="è‡ªåŠ¨ç”Ÿæˆ"/>
      </view>
      <view class="form-item">
        <text class="form-label">èµ·ç‚¹</text>
        <input class="form-input" value="{{newReservation.startPoint}}" bindinput="setStartPoint" placeholder="è¯·è¾“å…¥èµ·ç‚¹"/>
      </view>
      <view class="form-item">
        <text class="form-label">ç»ˆç‚¹</text>
        <input class="form-input" value="{{newReservation.endPoint}}" bindinput="setEndPoint" placeholder="è¯·è¾“å…¥ç»ˆç‚¹"/>
      </view>
      <view class="form-item">
        <text class="form-label">æ—¥æœŸ</text>
        <picker mode="date" value="{{newReservation.date}}" bindchange="setDate">
          <view class="form-picker">{{newReservation.date || 'é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="form-label">æ—¶é—´</text>
        <picker mode="time" value="{{newReservation.time}}" bindchange="setTime">
          <view class="form-picker">{{newReservation.time || 'é€‰æ‹©æ—¶é—´'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="form-label">è½¦è¾†ç±»å‹</text>
        <input class="form-input" value="{{newReservation.vehicleType}}" bindinput="setVehicleType" placeholder="è¯·è¾“å…¥è½¦è¾†ç±»å‹"/>
      </view>
      <view class="form-item">
        <text class="form-label">è½¦ç‰Œå·</text>
        <input class="form-input" value="{{newReservation.licensePlate}}" bindinput="setLicensePlate" placeholder="è¯·è¾“å…¥è½¦ç‰Œå·"/>
      </view>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="hideAddReservationForm">å–æ¶ˆ</button>
      <button class="modal-btn confirm" bindtap="submitAddReservation">ç¡®è®¤æ·»åŠ </button>
    </view>
  </view>
</view>
