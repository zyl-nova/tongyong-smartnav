<!--pages/mine-part/history-route/history-route.wxml-->
<view class="container">
  <scroll-view scroll-y class="history-scroll" bindscrolltolower="onReachBottom" refresher-enabled bindrefresherrefresh="onPullDownRefresh" refresher-triggered="{{isRefreshing}}">
    <view class="history-list">
      <view class="history-card" wx:for="{{historyList}}" wx:key="id">
        <!-- å¡ç‰‡å¤´éƒ¨ï¼šè¡Œç¨‹IDå’Œæ—¥æœŸæ—¶é—´ -->
        <view class="card-header">
          <view class="header-left">
            <text class="route-id">è¡Œç¨‹ID: {{item.id}}</text>
          </view>
          <view class="header-right">
            <text class="route-date">{{item.date}}</text>
            <text class="route-time">{{item.time}}</text>
          </view>
        </view>

        <!-- è·¯çº¿ä¿¡æ¯ -->
        <view class="route-section">
          <view class="route-line">
            <view class="route-point start">
              <view class="point-marker start-marker">èµ·</view>
              <text class="point-text">{{item.startPoint}}</text>
            </view>
            <view class="route-arrow">
              <view class="arrow-line"></view>
              <view class="arrow-head"></view>
            </view>
            <view class="route-point end">
              <view class="point-marker end-marker">ç»ˆ</view>
              <text class="point-text">{{item.endPoint}}</text>
            </view>
          </view>
        </view>

        <!-- è¯¦ç»†ä¿¡æ¯æ ‡ç­¾ -->
        <view class="info-tags">
          <view class="info-tag">
            <text class="tag-icon">ğŸ“</text>
            <text class="tag-text">é‡Œç¨‹: {{item.distance}}</text>
          </view>
          <view class="info-tag">
            <text class="tag-icon">â±</text>
            <text class="tag-text">è€—æ—¶: {{item.duration}}</text>
          </view>
          <view class="info-tag">
            <text class="tag-icon">ğŸ“¦</text>
            <text class="tag-text">è´§ç‰©: {{item.cargoInfo}}</text>
          </view>
        </view>

        <!-- å¸æœºä¿¡æ¯å’ŒçŠ¶æ€ -->
        <view class="card-footer">
          <view class="driver-section">
            <view class="driver-avatar-wrap">
              <image class="driver-avatar" src="{{item.driverAvatar}}" mode="aspectFill"></image>
            </view>
            <view class="driver-info">
              <text class="driver-name">{{item.driverName}}</text>
              <text class="driver-plate">{{item.licensePlate}}</text>
            </view>
          </view>
          <view class="status-section">
            <view class="route-status {{item.status === 'completed' ? 'status-completed' : 'status-cancelled'}}">
              {{item.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²å–æ¶ˆ'}}
            </view>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’®ï¼ˆå¯é€‰ï¼Œæ»‘åŠ¨åˆ é™¤æˆ–ç‚¹å‡»åˆ é™¤ï¼‰ -->
        <view class="action-bar" bindtap="showDeleteDialog" data-index="{{index}}">
          <text class="action-text">åˆ é™¤è®°å½•</text>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{isLoadingMore}}">
        <text>åŠ è½½ä¸­...</text>
      </view>
      <view class="no-more" wx:if="{{!hasMoreData && historyList.length > 0}}">
        <text>â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-container" wx:if="{{historyList.length === 0 && !isRefreshing}}">
      <image class="empty-image" src="/images/hu/empty.png" mode="aspectFit"></image>
      <text class="empty-text">æš‚æ— å†å²è·¯çº¿</text>
    </view>
  </scroll-view>

  <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
  <view class="delete-dialog" wx:if="{{showDeleteDialog}}">
    <view class="dialog-mask" bindtap="hideDeleteDialog"></view>
    <view class="dialog-content">
      <text class="dialog-title">ç¡®è®¤åˆ é™¤</text>
      <text class="dialog-message">ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è·¯çº¿è®°å½•å—ï¼Ÿ</text>
      <view class="dialog-buttons">
        <button class="dialog-button cancel" bindtap="hideDeleteDialog">å–æ¶ˆ</button>
        <button class="dialog-button confirm" bindtap="confirmDelete">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>
